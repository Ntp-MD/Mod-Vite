import{r as A,d as D,_ as Ne,h as Ie,c as N,e as d,F as U,f as X,u as r,i as Se,t as I,o as S,n as ie,j as Le}from"./index-BPZ_MweK.js";const Q=A([]),Y=A(1),z=A([]),W=A({}),E=A([]),x=A(0),k=A(0),p=A("idle"),w=A(0),J=A(0),ne=10,i=A(6),Fe=["#ffffff","#ffffff","#ffffff","#ffffff","#ffffff","#ffffff"],Oe=A([500,500,500,500,500,500]),O=A(0),ve=A(!0),C=A([]),v=A([]),f=A([]),m=A([]),ue=A([]),re=A([]),Ee=D(()=>v.value[0]===0),$=A([]),He=[5,10,30,50],M=5,se=D(()=>Math.max(0,w.value-(f.value[0]||0))),Ke=D(()=>v.value[0]+(f.value[0]||0)),Ae=D(()=>p.value==="idle"?!1:w.value===(f.value[0]||0)),_e=D(()=>w.value>(f.value[0]||0)&&v.value[0]>=w.value-(f.value[0]||0)),Ce=D(()=>v.value[0]>w.value-(f.value[0]||0));D(()=>!0);const Re=D(()=>v.value[0]>0&&p.value!=="idle"&&p.value!=="showdown"),oe=A(null),me=[{aggression:.5,tightness:.5},{aggression:.5,tightness:.5},{aggression:.5,tightness:.5},{aggression:.5,tightness:.5},{aggression:.5,tightness:.5},{aggression:.5,tightness:.5}];function je(e){return C.value.forEach((a,n)=>{const t=new RegExp(`\\b${a}\\b`,"g");e=e.replace(t,`<span class="player-log-color" style="color: ${Fe[n]}">${a}</span>`)}),e}function b(e){Q.value[Y.value-1]||(Q.value[Y.value-1]=[]),Q.value[Y.value-1].push(je(e))}function ge(e){switch(e){case"♠":return"spades";case"♥":return"hearts";case"♦":return"diamonds";case"♣":return"clubs";default:return""}}function Z(e){return{2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,10:10,J:11,Q:12,K:13,A:14}[e]}function Ge(e){const a={};for(const n of e)if(a[n.suit]=(a[n.suit]||0)+1,a[n.suit]>=5)return n.suit;return null}function ke(e){let a=[...new Set(e)].sort((n,t)=>t-n);a.includes(14)&&a.push(1);for(let n=0;n<=a.length-5;n++){let t=!0;for(let l=1;l<5;l++)if(a[n+l]!==a[n]-l){t=!1;break}if(t)return a.slice(n,n+5)}return null}function Me(){const e=["♠","♥","♦","♣"],a=["2","3","4","5","6","7","8","9","10","J","Q","K","A"],n=[];for(const t of e)for(const l of a)n.push({rank:l,suit:t});for(let t=n.length-1;t>0;t--){const l=Math.floor(Math.random()*(t+1));[n[t],n[l]]=[n[l],n[t]]}return n}function Pe(e,a){const n={};for(let t=0;t<e;t++)n[t]=z.value.splice(0,a);return n}function Te(){O.value=Math.floor(Math.random()*i.value);const e=["Dealer","SB","BB","UTG","MP","CO"];for(let a=0;a<i.value;a++){const n=(a-O.value+i.value)%i.value;re.value[a]=e[n]||`P${a}`}}function Qe(){if(v.value[0]===0){p.value="idle",b("You are busted. Game over!");return}const e=v.value.map((a,n)=>a>0?n:-1).filter(a=>a!==-1);v.value=e.map(a=>v.value[a]),C.value=e.map(a=>C.value[a]),f.value=e.map(a=>f.value[a]||0),m.value=e.map(a=>m.value[a]||!1),ue.value=e.map(a=>ue.value[a]||""),$.value=e.map(a=>$.value[a]||!1),W.value=e.map(a=>W.value[a]),i.value=v.value.length}function Ye(e){const a=e.map(c=>Z(c.rank));e.map(c=>c.suit);const n={};for(let c of a)n[c]=(n[c]||0)+1;const t=Ge(e);let l=[];t&&(l=e.filter(c=>c.suit===t).map(c=>Z(c.rank)).sort((c,_)=>_-c));let u=null;l.length>=5&&(u=ke(l));const s=[...new Set(a)].sort((c,_)=>_-c),o=Object.entries(n).map(([c,_])=>({val:+c,count:_})).sort((c,_)=>_.count-c.count||_.val-c.val);if(u)return u[0]===14?{handName:"Royal Flush",handRank:10,values:u}:{handName:"Straight Flush",handRank:9,values:u};if(o[0].count===4){const c=s.find(_=>_!==o[0].val);return{handName:"Four of a Kind",handRank:8,values:[o[0].val,c]}}if(o[0].count===3&&o[1]&&o[1].count>=2)return{handName:"Full House",handRank:7,values:[o[0].val,o[1].val]};if(l.length>=5)return{handName:"Flush",handRank:6,values:l.slice(0,5)};const B=ke(a);if(B)return{handName:"Straight",handRank:5,values:B};if(o[0].count===3){const c=s.filter(_=>_!==o[0].val).slice(0,2);return{handName:"Three of a Kind",handRank:4,values:[o[0].val,...c]}}if(o[0].count===2&&o[1]&&o[1].count===2){const c=o[0].val,_=o[1].val,F=s.find(V=>V!==c&&V!==_);return{handName:"Two Pair",handRank:3,values:[c,_,F]}}if(o[0].count===2){const c=o[0].val,_=s.filter(F=>F!==c).slice(0,3);return{handName:"One Pair",handRank:2,values:[c,..._]}}return{handName:"High Card",handRank:1,values:s.slice(0,5)}}function Je(e){J.value=Math.min(Ke.value,J.value+e)}function De(e){J.value=Math.max(M,J.value-e)}function pe(){Q.value=[],Y.value=1,z.value=Me(),E.value=[],x.value=0,k.value=0,p.value="betting",w.value=0,C.value=Array.from({length:i.value},(s,o)=>o===0?"You":`AI ${o}`),W.value=Pe(i.value,2),v.value=Array(i.value).fill(0).map((s,o)=>Oe.value[o]??500),f.value=Array(i.value).fill(0),m.value=Array(i.value).fill(!1),ue.value=Array(i.value).fill(""),$.value=Array(i.value).fill(!1),Te();const e=ne*1,a=ne*2,n=(O.value+1)%i.value,t=(O.value+2)%i.value;b(`--- Round ${Y.value} ---`);const l=Math.min(e,v.value[n]);l>0&&(v.value[n]-=l,f.value[n]+=l,x.value+=l,b(`${C.value[n]} posts small blind: ${l}$`));const u=Math.min(a,v.value[t]);u>0&&(v.value[t]-=u,f.value[t]+=u,x.value+=u,b(`${C.value[t]} posts big blind: ${u}$`)),w.value=f.value[t],k.value=(t+1)%i.value,G()}function be(){O.value=0,Y.value=1,Q.value=[],p.value="idle",C.value=[],v.value=[],f.value=[],m.value=[],ue.value=[],re.value=[],$.value=[],E.value=[],x.value=0,k.value=0,z.value=[],W.value={},J.value=M,b("Game reset. Configure settings and click 'Start Game' to begin.")}function ye(){if(!ve.value){b("Cannot start a new round before the current one ends.");return}if(ve.value=!1,Qe(),i.value<2){b("Not enough players to continue the game."),ve.value=!0;return}O.value=(O.value+1)%i.value,Y.value++,Q.value=[],z.value=Me(),E.value=[],x.value=0,p.value="betting",w.value=0,W.value=Pe(i.value,2),f.value=Array(i.value).fill(0),m.value=Array(i.value).fill(!1),ue.value=Array(i.value).fill(""),$.value=Array(i.value).fill(!1),Te(),b(`--- Round ${Y.value} ---`);const e=ne*1,a=ne*2,n=(O.value+1)%i.value,t=(O.value+2)%i.value,l=Math.min(e,v.value[n]);l>0&&(v.value[n]-=l,f.value[n]+=l,x.value+=l,b(`${C.value[n]} posts small blind: ${l}$`));const u=Math.min(a,v.value[t]);u>0&&(v.value[t]-=u,f.value[t]+=u,x.value+=u,b(`${C.value[t]} posts big blind: ${u}$`)),w.value=f.value[t],k.value=(t+1)%i.value,G()}function Ve(){E.value=z.value.splice(0,3),p.value="flop",$.value=Array(i.value).fill(!1)}function We(){E.value.push(z.value.splice(0,1)[0]),p.value="turn",$.value=Array(i.value).fill(!1)}function ze(){E.value.push(z.value.splice(0,1)[0]),p.value="river",$.value=Array(i.value).fill(!1)}function $e(){f.value=Array(i.value).fill(0),w.value=0,oe.value=null,J.value=0;let e="",a=!1;if(p.value==="betting"?(Ve(),e="--- Flop ---"):p.value==="flop"?(We(),e="--- Turn ---"):p.value==="turn"?(ze(),e="--- River ---"):p.value==="river"?(p.value="showdown",determineWinner(),a=!0):(console.error("proceedToNextPhase called with unexpected gamePhase:",p.value),a=!0),e&&b(e),a)return!0;let n=-1,t;i.value===2?t=O.value:t=(O.value+1)%i.value;for(let l=0;l<i.value;l++){const u=(t+l)%i.value;if(!m.value[u]){n=u;break}}return n!==-1?k.value=n:console.error("CRITICAL: No active player found to start new betting round in proceedToNextPhase."),!1}let ce=!1;async function G(){if(!ce){ce=!0;try{for(;;){const a=k.value;if(m.value.filter(t=>!t).length<=1){p.value!=="showdown"&&(p.value="showdown",determineWinner());return}if(m.value[a]){k.value=(a+1)%i.value;continue}if(v.value[a]===0&&!m.value[a]&&!$.value[a])$.value[a]=!0;else if(v.value[a]>0&&!m.value[a]&&!$.value[a])break;let n=!0;for(let t=0;t<i.value;t++)if(!m.value[t]&&v.value[t]>0&&!$.value[t]){n=!1;break}if(n){if(!$e()){const l=v.value.map((s,o)=>o).filter(s=>!m.value[s]),u=l.filter(s=>v.value[s]>0);l.length>1&&u.length<=1&&p.value,setTimeout(G,200)}return}k.value=(a+1)%i.value}if(k.value===0&&v.value[0]>0&&!$.value[0]&&!m.value[0])return;try{const a=Ue(k.value);await new Promise(n=>setTimeout(n,200)),qe(k.value,a)}catch(a){console.error(`Error during AI ${C.value[k.value]}'s turn:`,a),b(`Error for ${C.value[k.value]}. They are folded due to an error.`),k.value>=0&&k.value<i.value&&(m.value[k.value]=!0,$.value[k.value]=!0)}let e=!0;for(let a=0;a<i.value;a++)if(!m.value[a]&&v.value[a]>0&&!$.value[a]){e=!1;break}if(e){if(!$e()){const n=v.value.map((l,u)=>u).filter(l=>!m.value[l]),t=n.filter(l=>v.value[l]>0);n.length>1&&t.length<=1&&p.value,setTimeout(G,200)}return}k.value=(k.value+1)%i.value,setTimeout(G,200)}catch(e){console.error("Critical error in nextTurn game logic:",e),b("A critical error occurred. Game progression might be halted.")}finally{ce=!1}}}function te(e,a=0){if(k.value!==0)return;let n="";if(e==="fold")m.value[0]=!0,n="You folded.";else if(e==="check"){if(!Ae.value)return;n="You checked."}else if(e==="call"){if(!_e.value)return;const t=se.value;v.value[0]-=t,f.value[0]+=t,x.value+=t,n=`You called $${t}`}else if(e==="raise"){if(!Ce.value)return;const t=se.value;let l=Math.max(M,a);if(l%10!==0)return;const u=t+l;if(v.value[0]<u)return;v.value[0]-=u,f.value[0]+=u,x.value+=u,w.value=f.value[0],oe.value=0,n=`You raised $${l} (to $${f.value[0]})`,$.value=$.value.map((s,o)=>!!(o===0||m.value[o]))}else if(e==="all-in"){if(!Re.value){b("You cannot go all-in at this time (e.g. game not active, or action not on you).");return}const t=v.value[0];v.value[0]=0,f.value[0]+=t,x.value+=t,n=`You go ALL-IN with $${t} (total bet $${f.value[0]})`,f.value[0]>w.value&&(w.value=f.value[0],oe.value=0,$.value=$.value.map((l,u)=>!!(u===0||m.value[u])),n+=", raising the bet!")}b(n),$.value[0]=!0,k.value=(k.value+1)%i.value,setTimeout(()=>G(),200)}function qe(e,a){let{action:n,amount:t}=a;const l=v.value[e],u=f.value[e]||0,s=w.value-u;if(n==="call"&&s===0&&(n="check"),n==="fold")m.value[e]=!0,b(`${C.value[e]} folds.`);else if(n==="raise"){const o=l-s;let B=Math.min(t,o);if(l>s+B&&(B=Math.max(M,B)),B<M)s===0?b(`${C.value[e]} checks.`):(m.value[e]=!0,b(`${C.value[e]} folds (unable to complete raise).`));else{const c=s+B;v.value[e]-=c,f.value[e]+=c,x.value+=c,w.value=f.value[e],oe.value=e,v.value[e]===0&&c>0?b(`${C.value[e]} raises ALL-IN by $${B} (total bet $${f.value[e]})`):b(`${C.value[e]} raises by $${B} (total bet $${f.value[e]})`),$.value=$.value.map((_,F)=>m.value[F]||F===e)}}else if(n==="call")if(l>=s)v.value[e]-=s,f.value[e]+=s,x.value+=s,b(`${C.value[e]} calls $${s}`);else{const o=l;x.value+=o,f.value[e]+=o,v.value[e]=0,b(`${C.value[e]} calls ALL-IN with $${o}`)}else n==="check"&&(s>0?(m.value[e]=!0,b(`${C.value[e]} (AI) attempts to check facing a bet of $${s}, and folds.`)):b(`${C.value[e]} checks.`));$.value[e]=!0}function Ue(e){const a=W.value[e],n=E.value,t=a.concat(n),l=Ye(t),u=v.value[e],s=w.value-(f.value[e]||0),o=x.value,B=m.value.filter(g=>!g).length,c=re.value[e]||e,_=i.value;if(n.length>0&&l.handName==="One Pair"){const g=n.map(y=>Z(y.rank)),T=Math.max(...g,0),P=a.map(y=>Z(y.rank)),h=P.includes(T),L=P.includes(14);if(h&&L)return s===0?{action:"raise",amount:Math.max(M,Math.floor(o*.5))}:s<=u*.4?{action:"call"}:{action:"fold"}}if(n.length===0){const g=a.map(le=>Z(le.rank)),T=g[0]===g[1],P=[["A","A"],["K","K"],["Q","Q"],["J","J"],["A","K"],["A","Q"],["A","J"],["K","Q"]],h=[a[0].rank,a[1].rank].sort(),L=P.some(le=>le.sort().toString()===h.toString()),y=Math.max(...g)>=11;if(T&&["A","K","Q","J","10","9","8","7"].includes(a[0].rank))return s===0?{action:"raise",amount:Math.max(M,30)}:s<=u*.2?{action:"call"}:{action:"fold"};if(L||!T&&y&&Math.min(...g)>=10)return s===0?{action:"raise",amount:Math.max(M,30)}:s<=u*.2?{action:"call"}:{action:"fold"}}let F=0,V=0,ee=0;for(let g=0;g<_;g++)g!==e&&!m.value[g]&&(F+=me[g].aggression,V+=me[g].tightness,ee++);F=ee?F/ee:.5,V=ee?V/ee:.5;const we=c>=_-2;let q=0;if(n.length>=3){const g={},T={};for(const y of n)g[y.suit]=(g[y.suit]||0)+1,T[y.rank]=(T[y.rank]||0)+1;Object.values(T).some(y=>y>=2)&&(q+=1),Object.values(g).some(y=>y>=3)&&(q+=1);const P={2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,10:10,J:11,Q:12,K:13,A:14},h=Object.keys(T).map(y=>P[y]).sort((y,le)=>y-le);let L=1;for(let y=1;y<h.length;y++)h[y]===h[y-1]+1?L++:L=1,L>=3&&(q+=1)}let H=0;if(l.handRank<4&&n.length>=3){const g={};for(const h of t)g[h.suit]=(g[h.suit]||0)+1;Object.values(g).some(h=>h===4)&&(H=.18);const T=t.map(h=>Z(h.rank)),P=[...new Set(T)].sort((h,L)=>h-L);for(let h=0;h<P.length-3;h++)P[h+3]-P[h]===3&&P.slice(h,h+4).length===4&&(H=Math.max(H,.17));for(let h=0;h<P.length-3;h++){const L=P.slice(h,h+4);L[3]-L[0]===4&&L.length===4&&(H=Math.max(H,.08))}}let fe=s/(o+s);H>0&&u>o*1.5&&(fe=s/(o+s+o*.5));let de=!1;if(n.length>=3){const g=n.map(T=>T.suit);for(const T of["♠","♥","♦","♣"])g.filter(P=>P===T).length>=3&&a.some(P=>P.suit===T&&P.rank==="A")&&(de=!0)}let j=!1,ae=.18+.18*(6-B);we&&(ae+=.1),V>.7&&(ae+=.15),H>0&&(ae+=.15),de&&(ae+=.12),Math.random()<ae&&q===0&&(j=!0);let K=1.7;u<o*.5&&(K*=1.3),u>o*2&&(K*=1.1),B>=4?K*=1:B===3?K*=1.2:B===2&&(K*=1.3);let R=M;l.handRank>=6&&Math.random()<.95*K?R=Math.min(u,Math.max(M,Math.floor(o*.75))):l.handRank>=4?R=Math.min(u,Math.max(M,Math.floor(o*.5))):j?R=Math.min(u,Math.max(M,Math.floor(o*.4))):R=Math.min(u,M),R=Math.floor(R/10)*10,R<M&&(R=M);const he=l.handRank>=4&&l.handRank<6,Be=F>.7&&q>0&&s>0,xe=ne*2;return u<=5*xe?s>=u?l.handRank>=2||j?{action:"allin"}:{action:"fold"}:s===0&&(l.handRank>=2||j)?{action:"allin"}:s<=u*.5&&(l.handRank>=2||j)?{action:"allin"}:{action:"fold"}:u<=s?l.handRank>=5||j?{action:"allin"}:{action:"fold"}:he&&Be&&s<=u*.2?{action:"call"}:Math.random()<.03?{action:"fold"}:m.value[e]?{action:"fold"}:H>0&&fe<H&&s<=u*.3?{action:"call"}:j&&s===0&&u>R&&R>=M?{action:"raise",amount:R}:l.handRank>=6&&Math.random()<.8*K?s===0&&u>R&&R>=M?{action:"raise",amount:R}:s<=R?{action:"call"}:{action:"fold"}:he?s===0&&Math.random()<.5*K&&!q&&u>R&&R>=M?{action:"raise",amount:R}:s<=R?{action:"call"}:{action:"fold"}:s===0?{action:"check"}:s<=M&&Math.random()<.6*K?{action:"call"}:j&&s<=R?{action:"call"}:{action:"fold"}}const Xe={class:"TableLayout"},Ze={class:"PlayerLineup"},ea={class:"PlayerName"},aa={class:"PlayerPos"},la={class:"PlayerPosition"},ta={class:"PlayerHand"},na={class:"RankCard"},ua={class:"SuitCard"},sa={class:"PlayerBet"},oa={class:"TableFlob"},ra={key:0,class:"TableFlobCard"},ia={class:"RankCard"},va={class:"SuitCard"},ca={class:"PoolMoney"},fa={class:"CurrentPhase"},da=["innerHTML"],ha={class:"ActionButton"},ma=["disabled"],ga=["disabled"],ka=["disabled"],pa=["disabled"],ba=["disabled"],ya={class:"ChipButton"},$a=["onClick"],Aa=["onClick"],_a={class:"TableSetting"},Ca=["disabled"],Ra=["disabled"],Ma={__name:"Table",setup(e){const a=A(null);return Ie(Q,()=>{Le(()=>{a.value&&(a.value.scrollTop=a.value.scrollHeight)})},{deep:!0}),(n,t)=>(S(),N("div",Xe,[d("div",Ze,[(S(!0),N(U,null,X(r(C),(l,u)=>(S(),N("div",{key:u,class:ie(["PlayerFrame",{currentTurn:u===r(k),foldedPlayers:r(m)[u],mainPlayer:u===0,Player:u!==0&&u===r(k)}])},[d("div",ea,[d("div",null,I(l),1),d("div",aa,"("+I(r(re)[u])+")",1)]),d("div",la,[d("div",null,"$"+I(r(v)[u]),1)]),d("div",ta,[(S(!0),N(U,null,X(r(W)[u],(s,o)=>(S(),N("div",{key:o,class:ie(["CardBody",[r(ge)(s.suit),{hideCard:u!==0&&r(p)!=="showdown"}]])},[d("div",na,I(s.rank),1),d("div",ua,I(s.suit),1)],2))),128))]),d("div",sa,"Bet: $"+I(r(f)[u]),1)],2))),128))]),d("div",oa,[r(E)&&r(E).length?(S(),N("div",ra,[(S(!0),N(U,null,X(r(E),(l,u)=>(S(),N("div",{key:u,class:ie(["CardBody",r(ge)(l.suit)])},[d("div",ia,I(l.rank),1),d("div",va,I(l.suit),1)],2))),128))])):Se("",!0),d("div",ca,I(r(x))+"$",1),d("div",fa,"Current Phase: "+I(r(p)),1)]),d("div",{class:"TimelineLog",ref_key:"timelineLogRef",ref:a},[(S(!0),N(U,null,X(r(Q),(l,u)=>(S(),N("div",{key:u,class:"RoundLog"},[d("div",null,[(S(!0),N(U,null,X(l,(s,o)=>(S(),N("div",{key:o,innerHTML:s},null,8,da))),128))])]))),128))],512),d("div",ha,[d("button",{onClick:t[0]||(t[0]=l=>r(te)("check")),disabled:!r(Ae)},"Check",8,ma),d("button",{onClick:t[1]||(t[1]=l=>r(te)("call",r(se))),disabled:!r(_e)},I(`Call $${r(se)}`),9,ga),d("button",{onClick:t[2]||(t[2]=l=>r(te)("raise",r(J))),disabled:!r(Ce)},"Raise $"+I(r(J)),9,ka),d("button",{onClick:t[3]||(t[3]=l=>r(te)("all-in")),disabled:!r(Re)},"All-In",8,pa),d("button",{onClick:t[4]||(t[4]=l=>r(te)("fold")),disabled:r(p)==="idle"||r(k)!==0},"Fold",8,ba)]),d("div",ya,[(S(!0),N(U,null,X(r(He),l=>(S(),N("div",{key:l,class:"ChipBtn"},[d("button",{onClick:u=>r(Je)(l)},"+ $"+I(l),9,$a),d("button",{onClick:u=>r(De)(l)},"- $"+I(l),9,Aa)]))),128))]),d("div",_a,[d("button",{onClick:t[5]||(t[5]=(...l)=>r(pe)&&r(pe)(...l)),disabled:r(p)!=="idle"},"Start Game",8,Ca),d("button",{onClick:t[6]||(t[6]=(...l)=>r(ye)&&r(ye)(...l)),disabled:r(p)!=="showdown"||r(Ee)},"Next",8,Ra),d("button",{onClick:t[7]||(t[7]=(...l)=>r(be)&&r(be)(...l))},"Reset")])]))}},Ba=Ne(Ma,[["__scopeId","data-v-7a9b9ca6"]]);export{Ba as default};
